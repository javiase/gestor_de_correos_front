<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Detalle de Correo</title>
  <link rel="stylesheet" href="/css/base.css??v=%ASSET_VERSION%" />
  <link rel="stylesheet" href="/css/layout.css?v=%ASSET_VERSION%" />
  <link rel="stylesheet" href="/css/components.css?v=%ASSET_VERSION%" />
  <link rel="stylesheet" href="/css/components/sidebar.css?v=%ASSET_VERSION%" />
  <link rel="stylesheet" href="/css/pages/email.css?v=%ASSET_VERSION%" />
  <link rel="stylesheet" href="/vendor/fontawesome-6.4.0/css/all.min.css?v=%ASSET_VERSION%">
</head>
<body>
    <div id="sidebarContainer"></div>
    <div class="main-content" id="mainContent">
        <div class="left-container">
            <div id="chatContainer" class="chat-container">
                <div id="historyContainer" style="visibility: hidden; opacity: 0;"></div>
                <div class="grid-container" style="visibility: hidden; opacity: 0;">
                    <div class="mail-container client actual">
                        <h2 data-i18n="email.lastReceivedMessage">Ultimo mensaje recibido</h2>

                        <!-- PANEL RECIBIDO -->
                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-header-content" style="justify-content: space-between;">
                                    <p id="emailFrom"><span data-i18n="email.from">De</span>: ---</p>
                                    <span id="emailDate">--:--</span>
                                </div>
                                <p class="panel-subject" id="emailSubject"><span data-i18n="email.subject">Asunto</span>: ---</p>
                            </div>
                            <div class="panel-scroll">
                                <div class="panel-content" id="receivedContent"></div>
                            </div>
                            <div class="panel-footer"></div>
                        </div>
                    </div>
                    <div class="mail-container bot actual">
                        <h2 data-i18n="email.botResponse">Respuesta del bot</h2>
                        <!-- PANEL RESPUESTA -->
                        <div class="panel ">
                            <div class="panel-header">
                                <div class="panel-header-content">
                                    <strong><span data-i18n="email.subject">Asunto</span>:&nbsp;&nbsp;</strong>
                                    <!-- aquÃ­ podrÃ¡ editarse el asunto -->
                                    <div
                                        id="responseSubject"
                                        class="panel-subject response-subject"
                                        contenteditable="false"
                                        data-i18n-placeholder="email.writeSubject"
                                        data-placeholder="Escribe el asuntoâ€¦"
                                    ></div>
                                </div>
                            </div>
                            <div class="panel-scroll">
                                <!-- idem: placeholder y siempre editable -->
                                <div
                                    class="panel-content response-body"
                                    id="responseContent"
                                    contenteditable="true"
                                    data-i18n-placeholder="email.writeResponse"
                                    data-placeholder="Escribe tu respuestaâ€¦"
                                ></div>
                            </div>
                            <div id="replyFilesPreview" class="attachments-grid"></div>
                            <div class="panel-footer">
                                <div class="left-actions">
                                    <button id="sendReply" class="send-button" data-i18n="email.send">Enviar</button>
                                    <!-- ðŸ†• Checkbox para cerrar conversaciÃ³n -->
                                    <label class="close-conversation-label" data-i18n-title="email.closeConversationTooltip" title="Marca esta opciÃ³n si esta respuesta cierra la conversaciÃ³n con el cliente">
                                        <input type="checkbox" id="closeConversationCheck">
                                        <span data-i18n="email.closeConversation">Cerrar Conversacion/Ticket</span>
                                    </label>
                                </div>

                                <div class="right-actions">
                                    <button id="attachBtn" class="icon-button attach-button" type="button" data-i18n-title="email.attach" aria-label="Adjuntar">
                                    <!-- icono paperclip -->
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                        <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.2a2 2 0 0 1-2.83-2.83l8.5-8.5"/>
                                    </svg>
                                    </button>

                                    <button id="deleteEmail" class="icon-button trash-button" aria-label="Borrar">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6l-1.35 14.11A2 2 0 0 1 15.66 22H8.34A2 2 0 0 1 6.35 20.11L5 6"></path>
                                        <path d="M14 10v6"></path>
                                        <path d="M10 10v6"></path>
                                        <line x1="9" y1="6" x2="9" y2="4"></line>
                                        <line x1="15" y1="6" x2="15" y2="4"></line>
                                    </svg>
                                    </button>
                                </div>
                                </div>

                                <input id="replyFilesInput" type="file" multiple hidden />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pagination">
                <!-- NavegaciÃ³n -->
                <button id="prevEmail" class="pagination-btn prev-btn">
                    <i class="fas fa-chevron-left"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span data-i18n="common.previous">Anterior</span>
                </button>
                <button id="nextEmail" class="pagination-btn next-btn">
                    <span data-i18n="common.next">Siguiente</span>&nbsp;&nbsp;&nbsp;&nbsp;<i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
        
        <!-- ðŸ†• BOTÃ“N DE TOGGLE DEL SIDEBAR (FUERA DEL SIDEBAR PARA QUE SIEMPRE SEA VISIBLE) -->
        <button class="sidebar-toggle-right" id="toggleRightSidebar" data-i18n-title="email.toggleSidebarInfo" title="Mostrar/Ocultar panel de informaciÃ³n" style="visibility: hidden; opacity: 0;">
            <i class="fas fa-chevron-left"></i>
        </button>
        
        <!-- ðŸ†• BARRA LATERAL DERECHA - INFO SHOPIFY -->
        <div class="right-sidebar" id="shopifyInfoSidebar" style="visibility: hidden; opacity: 0;">
            <div class="sidebar-content">
                <!-- 1ï¸âƒ£ ENCABEZADO CONTEXTUAL -->
                <div id="contextualHeader" class="contextual-header"></div>

                <!-- 2ï¸âƒ£ CARD DE PEDIDO -->
                <div id="orderCard" class="primary-card order-card"></div>

                <!-- 3ï¸âƒ£ CARD DE CLIENTE -->
                <div id="customerCard" class="primary-card customer-card"></div>

                <!-- 4ï¸âƒ£ PANELES SECUNDARIOS (ACORDEONES) -->
                <div id="secondaryPanels" class="secondary-panels"></div>

                <!-- 5ï¸âƒ£ BARRA DE ACCIONES (FIJA AL FONDO) -->
                <div id="actionBar" class="action-bar">
                    <button class="action-btn" id="actionReembolso" disabled data-tooltip="No disponible">
                        <i class="fas fa-undo"></i>
                        <span data-i18n="email.refund">Reembolso</span>
                    </button>
                    <button class="action-btn" id="actionCancelar" disabled data-tooltip="No disponible">
                        <i class="fas fa-edit"></i>
                        <span data-i18n="email.modify">Modificar</span>
                    </button>
                    <button class="action-btn" id="actionTracking" disabled data-tooltip="No disponible">
                        <i class="fas fa-shipping-fast"></i>
                        <span data-i18n="email.trackingAction">Tracking</span>
                    </button>
                    <button class="action-btn" id="actionDescuento" disabled data-tooltip="No disponible">
                        <i class="fas fa-percent"></i>
                        <span data-i18n="email.discount">Descuento</span>
                    </button>
                </div>
            </div>
        </div>
  </div>

  <!-- ðŸ†• MODAL DE REFUND -->
  <div id="refundModal" class="refund-modal" style="display: none;">
    <div class="refund-modal-overlay"></div>
    <div class="refund-modal-content">
      <div class="refund-modal-header">
        <h2 data-i18n="email.createRefund">Crear Reembolso</h2>
        <button class="refund-modal-close" id="closeRefundModal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="refund-modal-body">
        <div class="refund-layout">
          <!-- COLUMNA IZQUIERDA -->
          <div class="refund-main">
            <!-- SECCIÃ“N: ITEMS DEL PEDIDO -->
            <div class="refund-card">
              <div class="refund-card-header">
                <span class="refund-badge refund-badge-warning">
                  <i class="fas fa-box-open"></i> <span data-i18n="email.unfulfilled">Unfulfilled</span>
                </span>
                <span class="refund-shop-location"></span>
              </div>
              <div class="refund-card-body">
                <div id="refundItemsList" class="refund-items-list">
                  <!-- Los items se renderizan aquÃ­ -->
                </div>
                <p class="refund-help-text" data-i18n="email.refundItems">Refunded items will be removed from the order</p>
              </div>
            </div>

            <!-- SECCIÃ“N: REFUND SHIPPING (condicional) -->
            <div id="refundShippingSection" class="refund-card" style="display: none;">
              <div class="refund-card-body">
                <h3 class="refund-section-title" data-i18n="email.refundShipping">Refund shipping</h3>
                <div class="refund-shipping-row">
                  <label class="refund-checkbox-label">
                    <input type="checkbox" id="refundShippingCheck" class="refund-checkbox">
                    <span class="refund-checkbox-text">
                      <span id="refundShippingName">shipping basic</span>
                      <span class="refund-text-separator">Â·</span>
                      <span id="refundShippingMaxAmount" class="refund-text-muted">$0.00</span>
                    </span>
                  </label>
                  <div class="refund-input-wrapper">
                    <span class="refund-input-prefix">$</span>
                    <input 
                      type="text" 
                      id="refundShippingAmount" 
                      class="refund-input" 
                      placeholder="0.00"
                      disabled
                    >
                  </div>
                </div>
                <div id="refundShippingError" class="refund-error-message" style="display: none;" data-i18n="email.refundExceedsAvailable">
                  El monto excede el disponible para reembolso
                </div>
              </div>
            </div>

            <!-- SECCIÃ“N: REASON FOR REFUND -->
            <div class="refund-card">
              <div class="refund-card-body">
                <h3 class="refund-section-title" data-i18n="email.refundReason">Reason for refund</h3>
                <input 
                  type="text" 
                  id="refundReason" 
                  class="refund-input refund-input-full" 
                  data-i18n-placeholder="email.refundReasonPlaceholder"
                  placeholder=""
                >
                <p class="refund-help-text" data-i18n="email.refundReasonHelp">Solo tÃº y otros miembros del personal pueden ver esta razÃ³n</p>
              </div>
            </div>
          </div>

          <!-- COLUMNA DERECHA: SUMMARY -->
          <div class="refund-sidebar">
            <div class="refund-card refund-summary">
              <div class="refund-card-body">
                <h3 class="refund-summary-title" data-i18n="email.refundSummary">Summary</h3>
                
                <!-- Subtotal de items -->
                <div class="refund-summary-row">
                  <span id="refundSummaryItemsLabel">No items selected</span>
                  <span id="refundSummaryItemsAmount" class="refund-summary-value">$0.00</span>
                </div>

                <!-- Shipping -->
                <div id="refundSummaryShippingRow" class="refund-summary-row" style="display: none;">
                  <span data-i18n="email.refundShippingAmount">Shipping</span>
                  <span id="refundSummaryShippingAmount" class="refund-summary-value">$0.00</span>
                </div>

                <div class="refund-summary-divider"></div>

                <!-- Total del refund -->
                <div class="refund-summary-row refund-summary-total">
                  <span data-i18n="email.refundTotal">Refund total</span>
                  <span id="refundSummaryTotal" class="refund-summary-value">$0.00</span>
                </div>

                <div class="refund-summary-divider"></div>

                <!-- Refund method -->
                <div class="refund-summary-section">
                  <h4 class="refund-summary-subtitle" data-i18n="email.refundMethod">Refund method</h4>
                  <select id="refundMethod" class="refund-select">
                    <option value="ORIGINAL_PAYMENT_METHODS" data-i18n="email.refundMethodOriginal">Original payment</option>
                    <option value="STORE_CREDIT" data-i18n="email.refundMethodCredit">Store credit</option>
                    <option value="ORIGINAL_AND_STORE_CREDIT" data-i18n="email.refundMethodMixed">Original payment and store credit</option>
                  </select>
                </div>

                <!-- Refund amount -->
                <div class="refund-summary-section">
                  <h4 class="refund-summary-subtitle" data-i18n="email.refundAmount">Refund amount</h4>
                  <div class="refund-summary-manual">
                    <span class="refund-text-small" data-i18n="email.refundManual">Manual</span>
                    <div class="refund-input-wrapper">
                      <input 
                        type="text" 
                        id="refundManualAmount" 
                        class="refund-input" 
                        placeholder="0.00"
                      >
                      <span class="refund-input-suffix">$</span>
                    </div>
                    <span id="refundAvailableAmount" class="refund-text-small refund-text-muted">$0.00 available for refund</span>
                  </div>
                  <div id="refundManualError" class="refund-error-message" style="display: none;" data-i18n="email.refundExceedsAvailable">
                    El monto excede el disponible para reembolso
                  </div>
                </div>

                <!-- BotÃ³n de refund -->
                <button id="submitRefundBtn" class="refund-submit-btn" disabled>
                  Refund $0.00
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ðŸ†• MODAL DE DESCUENTO -->
  <div id="discountModal" class="refund-modal" style="display: none;">
    <div class="refund-modal-overlay"></div>
    <div class="refund-modal-content discount-modal-content">
      <div class="refund-modal-header">
        <h2 data-i18n="email.createDiscount">Crear cÃ³digo de descuento</h2>
        <button class="refund-modal-close" id="closeDiscountModal">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="refund-modal-body discount-body">
        <!-- COLUMNA IZQUIERDA -->
        <div class="discount-main">
          <div class="refund-card">
            <div class="refund-card-body">
              <h3 class="refund-section-title" data-i18n="email.discountData">Datos del descuento</h3>

              <label class="refund-input-label" for="discountCodeInput" data-i18n="email.discountCode">CÃ³digo de descuento</label>
              <input
                id="discountCodeInput"
                class="refund-input refund-input-full"
                type="text"
                autocomplete="off"
                data-i18n-placeholder="email.discountCodePlaceholder"
                placeholder="Ej. GRACIAS10"
              />

              <p id="discountCodeHelp" class="refund-help-text" data-i18n="email.discountCodeHelp">
                CÃ³digo de 1 solo uso para este cliente.
              </p>

              <div class="discount-type-group">
                <span class="refund-section-title" data-i18n="email.discountType">Tipo de descuento</span>
                <div class="discount-type-options">
                  <label class="refund-checkbox-label">
                    <input
                      id="discountTypePercent"
                      type="radio"
                      name="discountType"
                      value="PERCENT"
                      checked
                    />
                    <span class="refund-checkbox-text" data-i18n="email.discountTypePercent">Porcentaje</span>
                  </label>
                  <label class="refund-checkbox-label">
                    <input
                      id="discountTypeAmount"
                      type="radio"
                      name="discountType"
                      value="AMOUNT"
                    />
                    <span class="refund-checkbox-text" data-i18n="email.discountTypeAmount">Cantidad fija</span>
                  </label>
                </div>
              </div>

              <label class="refund-input-label" for="discountValueInput" data-i18n="email.discountValue">Valor</label>
              <div class="refund-input-wrapper">
                <input
                  id="discountValueInput"
                  class="refund-input"
                  type="text"
                  inputmode="decimal"
                  placeholder="0"
                  autocomplete="off"
                />
                <span class="refund-input-suffix" id="discountValueSuffix">%</span>
              </div>
              <p class="refund-help-text" id="discountValueHelp" data-i18n="email.discountValueHelp">
                Para porcentaje, usa valores entre 0 y 100.
              </p>
            </div>
          </div>
        </div>

        <!-- COLUMNA DERECHA -->
        <div class="discount-sidebar">
          <div class="refund-card refund-summary">
            <div class="refund-card-body">
              <h3 class="refund-summary-title" data-i18n="email.discountSummaryTitle">Resumen</h3>

              <div class="refund-summary-row">
                <span data-i18n="email.discountCustomer">Cliente</span>
                <span id="discountCustomerLabel" class="refund-summary-value">
                  â€”
                </span>
              </div>

              <div class="refund-summary-divider"></div>

              <div class="refund-summary-row">
                <span data-i18n="email.discount">Descuento</span>
                <span id="discountSummaryMain" class="refund-summary-value" data-i18n="email.discountSummaryMain">
                  Define el importe del descuento
                </span>
              </div>

              <p id="discountSummaryDetails" class="refund-help-text" data-i18n="email.discountSummaryDetails">
                1 uso Â· sin mÃ­nimo de compra Â· sin combinaciones Â· activo al crearse.
              </p>

              <div class="refund-summary-divider"></div>

              <button
                id="discountSubmitBtn"
                class="refund-submit-btn"
                disabled
              >
                <i class="fas fa-percent"></i>
                <span data-i18n="email.createDiscountButton">Crear cÃ³digo</span>
              </button>

              <button
                id="openDiscountsInShopifyBtn"
                class="refund-submit-btn refund-submit-secondary"
                type="button"
              >
                <i class="fas fa-external-link-alt"></i>
                <span data-i18n="email.openAdvancedDiscounts">Abrir descuentos avanzados en Shopify</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/js/vendor/dompurify.min.js?v=%ASSET_VERSION%"></script>
  <script type="module" src="/js/config.js?v=%ASSET_VERSION%"></script>
  <script type="module" src="/js/utils/api.js?v=%ASSET_VERSION%"></script>
  <script type="module" src="/js/components/sidebar.js?v=%ASSET_VERSION%"></script>
  <script type="module" src="/js/pages/email.js?v=%ASSET_VERSION%"></script>
</body>
</html>