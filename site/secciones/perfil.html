<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - Settings</title>
    <link rel="stylesheet" href="/css/base.css?v=%ASSET_VERSION%" />
    <link rel="stylesheet" href="/css/layout.css?v=%ASSET_VERSION%" />
    <link rel="stylesheet" href="/css/components/sidebar.css?v=%ASSET_VERSION%" />
    <link rel="stylesheet" href="/css/pages/perfil.css?v=%ASSET_VERSION%">
    <link rel="stylesheet" href="/vendor/fontawesome-6.4.0/css/all.min.css?v=%ASSET_VERSION%">
</head>
<body>
    <div id="sidebarContainer"></div>
    <div class="main-content" id="mainContent">
        <div class="profile-container">
            <!-- Header -->
            <div class="profile-header">
                <div class="header-content">
                    <div class="user-avatar">
                        <img alt="User Avatar" id="userAvatar">
                        <button class="avatar-edit-btn" id="avatarEditBtn">
                            <i class="fas fa-camera"></i>
                        </button>
                        <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                    </div>
                    <div class="user-info">
                        <h1 class="user-name" id="displayUserName"></h1>
                        <p class="user-email" id="displayUserEmail"></p>
                        <div class="plan-row">
                            <p class="user-plan" id="displayUserPlan">‚Äî</p>

                            <!-- Badge de trial -->
                            <span class="trial-badge hidden" id="trialBadge" title="">
                                <i class="fas fa-gift"></i>
                                <span id="trialDays">0</span> <span data-i18n="profile.trialDaysRemaining">d√≠as de prueba gratis restantes</span>
                            </span>
                        </div>
                        <span class="user-status">Active</span>
                        <button id="logoutBtn" class="logout-btn" data-i18n="navbar.logout">Cerrar sesi√≥n</button>
                    </div>
                </div>
                <div class="header-actions-left">
                    <div class="stats-container">
                        <div class="stat-card stat-used">
                            <div class="stat-icon"><i class="fas fa-clock"></i></div>
                            <div class="stat-info">
                            <div class="stat-value" id="reservedConversations">0</div>
                            <div class="stat-label" data-i18n="profile.inProgress">En curso</div>
                            </div>
                        </div>
                        <div class="stat-card stat-confirmed">
                            <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                            <div class="stat-info">
                            <div class="stat-value" id="confirmedConversations">0</div>
                            <div class="stat-label" data-i18n="profile.confirmed">Confirmadas</div>
                            </div>
                        </div>
                        <div class="stat-card stat-extra">
                            <div class="stat-icon"><i class="fas fa-bolt"></i></div>
                            <div class="stat-info">
                            <div class="stat-value" id="extraCredits">0</div>
                            <div class="stat-label" data-i18n="profile.extra">Extra</div>
                            </div>
                        </div>
                        <div class="stat-card stat-total">
                            <div class="stat-icon"><i class="fas fa-infinity"></i></div>
                            <div class="stat-info">
                            <div class="stat-value" id="totalLimit">0</div>
                            <div class="stat-label" data-i18n="profile.limit">L√≠mite</div>
                            </div>
                        </div>
                    </div>
                    <a href="plans.html" class="btn-manage-plan" id="managePlanBtn" data-requires-complete="true">
                        <i class="fas fa-cogs"></i> <span data-i18n="profile.managePlan">Gestionar plan</span>
                    </a>
                </div>
                <div class="header-actions-right">
                    <div class="header-actions">
                        <button class="btn btn-secondary" id="cancelBtn" data-i18n="common.cancel">Cancelar</button>
                        <button class="btn btn-primary" id="saveBtn" data-i18n="profile.saveChanges">Guardar Cambios</button>
                    </div>
                    <!-- <div class="profile-progress" id="profileProgress">
                        <div class="profile-progress-bar" id="profileProgressBar" style="width:0%"></div>
                    </div> -->
                </div>
                
            </div>
            <div id="profileGateNotice" class="profile-lock-banner hidden" role="alert" aria-live="polite">
                <i class="fas fa-info-circle"></i>
                <div>
                    <strong data-i18n="profile.incompleteProfile">Tu perfil est√° incompleto.</strong>
                    <span id="profileGateText" data-i18n="profile.incompleteProfileText">
                        Rellena los campos obligatorios marcados con * para desbloquear todas las funciones.
                    </span>
                </div>
            </div>

            <!-- Profile Content -->
            <div class="profile-content">
                <!-- üÜï Aplicar c√≥digo de referido -->
                <div class="referral-code-apply-section" id="referralCodeApplySection">
                    <div class="referral-code-apply-card">
                        <div class="referral-code-header">
                            <i class="fas fa-ticket-alt"></i>
                            <div>
                                <h3 data-i18n="onboarding.referralCodeTitle">¬øTienes un c√≥digo de referido?</h3>
                                <p data-i18n="onboarding.referralCodeSubtitle">Si alguien te invit√≥ o tienes un c√≥digo de un partner, ingr√©salo aqu√≠</p>
                            </div>
                        </div>
                        <div class="referral-code-body">
                            <div class="referral-code-input-group">
                                <input 
                                    type="text" 
                                    id="referralCodeInput" 
                                    class="referral-code-input" 
                                    data-i18n-placeholder="onboarding.referralCodePlaceholder"
                                    placeholder="Ingresa tu c√≥digo"
                                    maxlength="50"
                                />
                                <button type="button" id="validateCodeBtn" class="btn btn-secondary" data-i18n="onboarding.validateCode">
                                    Validar
                                </button>
                                <button type="button" id="applyCodeBtn" class="btn btn-primary hidden" data-i18n="onboarding.applyCode">
                                    Aplicar c√≥digo
                                </button>
                            </div>
                            <div id="referralCodeMessage" class="referral-code-message hidden"></div>
                        </div>
                    </div>
                </div>

                <!-- Store Information Section -->
                <div class="profile-section">
                    <div class="section-header-profile">
                        <h2 data-i18n="profile.storeInfo">Informaci√≥n de la Tienda</h2>
                        <p data-i18n="profile.storeInfoDescription">Gestiona los detalles y configuraciones de tu tienda</p>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="storeName" data-i18n="profile.storeName">Nombre de la Tienda *</label>
                            <input type="text" id="storeName" class="form-input" required>
                            <span class="form-hint" data-i18n="profile.storeNameHint">As√≠ es como aparecer√° tu tienda para los clientes</span>
                        </div>
                        
                        <div class="form-group">
                            <label for="storeUrl" data-i18n="profile.storeUrl">URL de la Tienda</label>
                            <div class="input-group">
                                <span class="input-prefix">https://</span>
                                <input type="text" id="storeUrl" class="form-input" placeholder="mystore.com">
                            </div>
                            <span class="form-hint" data-i18n="profile.storeUrlHint">URL del sitio web de tu tienda</span>
                        </div>
                        
                        <div class="form-group">
                            <label for="storeDescription" data-i18n="profile.storeDescription">Descripci√≥n de la Tienda</label>
                            <textarea id="storeDescription" class="form-textarea" rows="3" data-i18n-placeholder="profile.storeDescriptionPlaceholder" placeholder="Cu√©ntale a los clientes sobre tu tienda..."></textarea>
                            <span class="form-hint" data-i18n="profile.storeDescriptionHint">Descripci√≥n breve de tu tienda (opcional)</span>
                        </div>

                        <div class="form-group">
                            <label for="businessCategory" data-i18n="profile.businessCategory">Categor√≠a del Negocio</label>
                            <select id="businessCategory" class="form-select">
                                <option value="" disabled selected data-i18n="profile.businessCategoryPlaceholder">Selecciona una categor√≠a</option>
                                <option value="fashion">Moda</option>
                                <option value="electronics">Electr√≥nica</option>
                                <option value="books">Libros</option>
                                <option value="home">Hogar</option>
                                <option value="other">Otro</option>
                            </select>
                            <span class="form-hint" data-i18n="profile.businessCategoryHint">¬øEn qu√© sector opera tu tienda?</span>
                        </div>
                        <div class="form-group hidden" id="businessCategoryOtherContainer">
                            <label for="businessCategoryOther" data-i18n="profile.businessCategoryOther">Otra categor√≠a</label>
                            <input type="text" id="businessCategoryOther" class="form-input" data-i18n-placeholder="profile.businessCategoryOtherPlaceholder" placeholder="Escribe tu categor√≠a">
                        </div>
                    </div>
                </div>
                
                <!-- Physical Location Section -->
                <div class="profile-section">
                    <div class="section-header-profile">
                        <h2 data-i18n="profile.physicalLocation">Ubicaci√≥n F√≠sica</h2>
                        <p data-i18n="profile.physicalLocationDescription">Configura la presencia f√≠sica de tu tienda</p>
                    </div>
                    
                    <div class="location-toggle">
                        <label class="checkbox-label">
                            <input type="checkbox" id="hasPhysicalLocation">
                            <span class="checkbox-custom"></span>
                            <span class="checkbox-text" data-i18n="profile.hasPhysicalLocation">Mi tienda tiene una ubicaci√≥n f√≠sica</span>
                        </label>
                    </div>
                    
                    <div class="location-fields" id="locationFields">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="storeAddress" data-i18n="profile.address">Direcci√≥n *</label>
                                <input type="text" id="storeAddress" class="form-input" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="storeCity" data-i18n="profile.city">Ciudad *</label>
                                <input type="text" id="storeCity" class="form-input" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="storeState" data-i18n="profile.state">Provincia *</label>
                                <input type="text" id="storeState" class="form-input" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="storeZip" data-i18n="profile.zip">C√≥digo Postal</label>
                                <input type="text" id="storeZip" class="form-input" >
                            </div>
                            
                            <div class="form-group">
                                <label for="storeCountry" data-i18n="profile.country">Pa√≠s *</label>
                                <select id="storeCountry" class="form-select" required>
                                    <option value="US" selected>Estados Unidos</option>
                                    <option value="CA">Canad√°</option>
                                    <option value="UK">Reino Unido</option>
                                    <option value="DE">Alemania</option>
                                    <option value="FR">Francia</option>
                                    <option value="ES">Espa√±a</option>
                                    <option value="IT">Italia</option>
                                    <option value="AU">Australia</option>
                                    <option value="JP">Jap√≥n</option>
                                    <option value="OTHER">Otro</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="storePhone" data-i18n="profile.phone">N√∫mero de Tel√©fono</label>
                                <input type="tel" id="storePhone" class="form-input" placeholder="+34 612345678">
                                <span class="form-hint" data-i18n="profile.phoneHint">+[c√≥digo pa√≠s][n√∫mero]</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Store Hours Section -->
                <div class="profile-section">
                    <div class="section-header-profile">
                        <h2 data-i18n="profile.openingHours">Horario de Apertura</h2>
                        <p data-i18n="profile.openingHoursDescription">Establece el horario de funcionamiento de tu tienda</p>
                    </div>
                    <div class="location-toggle">
                    <label class="checkbox-label">
                        <input type="checkbox" id="hasOpeningHours">
                        <span class="checkbox-custom"></span>
                        <span class="checkbox-text" data-i18n="profile.hasOpeningHours">Tengo horario de apertura</span>
                    </label>
                    </div>
                    <div class="hours-container" id="openingHoursFields">
                        <div class="hours-day" data-day="monday">
                            <div class="day-label" data-i18n="profile.monday">Lunes</div>
                            <div class="day-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" class="day-toggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>

                                <!-- Contenedor de tramos (se rellena por JS) -->
                                <div class="slots" data-day-slots></div>

                                <button type="button" class="btn add-slot" data-action="add-slot">
                                    <i class="fas fa-plus"></i> <span data-i18n="profile.addSlot">A√±adir tramo</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="hours-day" data-day="tuesday">
                            <div class="day-label" data-i18n="profile.tuesday">Martes</div>
                            <div class="day-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" class="day-toggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>

                                <!-- Contenedor de tramos (se rellena por JS) -->
                                <div class="slots" data-day-slots></div>

                                <button type="button" class="btn add-slot" data-action="add-slot">
                                    <i class="fas fa-plus"></i> <span data-i18n="profile.addSlot">A√±adir tramo</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="hours-day" data-day="wednesday">
                            <div class="day-label" data-i18n="profile.wednesday">Mi√©rcoles</div>
                            <div class="day-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" class="day-toggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>

                                <!-- Contenedor de tramos (se rellena por JS) -->
                                <div class="slots" data-day-slots></div>

                                <button type="button" class="btn add-slot" data-action="add-slot">
                                    <i class="fas fa-plus"></i> <span data-i18n="profile.addSlot">A√±adir tramo</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="hours-day" data-day="thursday">
                            <div class="day-label" data-i18n="profile.thursday">Jueves</div>
                            <div class="day-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" class="day-toggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>

                                <!-- Contenedor de tramos (se rellena por JS) -->
                                <div class="slots" data-day-slots></div>

                                <button type="button" class="btn add-slot" data-action="add-slot">
                                    <i class="fas fa-plus"></i> <span data-i18n="profile.addSlot">A√±adir tramo</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="hours-day" data-day="friday">
                            <div class="day-label" data-i18n="profile.friday">Viernes</div>
                            <div class="day-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" class="day-toggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>

                                <!-- Contenedor de tramos (se rellena por JS) -->
                                <div class="slots" data-day-slots></div>

                                <button type="button" class="btn add-slot" data-action="add-slot">
                                    <i class="fas fa-plus"></i> <span data-i18n="profile.addSlot">A√±adir tramo</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="hours-day" data-day="saturday">
                            <div class="day-label" data-i18n="profile.saturday">S√°bado</div>
                            <div class="day-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" class="day-toggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>

                                <!-- Contenedor de tramos (se rellena por JS) -->
                                <div class="slots" data-day-slots></div>

                                <button type="button" class="btn add-slot" data-action="add-slot">
                                    <i class="fas fa-plus"></i> <span data-i18n="profile.addSlot">A√±adir tramo</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="hours-day" data-day="sunday">
                            <div class="day-label" data-i18n="profile.sunday">Domingo</div>
                            <div class="day-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" class="day-toggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>

                                <!-- Contenedor de tramos (se rellena por JS) -->
                                <div class="slots" data-day-slots></div>

                                <button type="button" class="btn add-slot" data-action="add-slot">
                                    <i class="fas fa-plus"></i> <span data-i18n="profile.addSlot">A√±adir tramo</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Personal Information Section -->
                <div class="profile-section">
                    <div class="section-header-profile">
                        <h2 data-i18n="profile.personalInfo">Informaci√≥n Personal</h2>
                        <p data-i18n="profile.personalInfoDescription">Los detalles de su cuenta personal</p>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="firstName" data-i18n="profile.firstName">Nombre *</label>
                            <input type="text" id="firstName" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="lastName" data-i18n="profile.lastName">Apellido *</label>
                            <input type="text" id="lastName" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="personalEmail">Correo Electr√≥nico *</label>
                            <input type="email" id="personalEmail" class="form-input" required>
                            <small class="form-hint" data-i18n="profile.emailNotifications">Este es el correo al que quieres que te lleguen las notificaciones de uso de correos y avisos importantes.</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="personalPhone" data-i18n="profile.phone">N√∫mero de Tel√©fono</label>
                            <input type="tel" id="personalPhone" class="form-input" placeholder="+34 612345678">
                            <span class="form-hint" data-i18n="profile.phoneHint">+[c√≥digo pa√≠s][n√∫mero]</span>
                        </div>
                        
                        <div class="form-group">
                            <label for="preferredLanguage" data-i18n="profile.language">Idioma</label>
                            <select id="preferredLanguage" class="form-select">
                                <option value="es">Espa√±ol</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- üÜï Referrals Section -->
                <div class="profile-section" id="referralsSection">
                    <div class="section-header-profile">
                        <h2 data-i18n="referrals.sectionTitle">Programa de Referidos</h2>
                        <p data-i18n="referrals.sectionDescription">Invita a otros y gana conversaciones extra gratis</p>
                    </div>

                    <div class="referrals-grid">
                        <!-- Mi c√≥digo -->
                        <div class="referral-card">
                            <div class="referral-card-header">
                                <i class="fas fa-gift"></i>
                                <h3 data-i18n="referrals.myCodeTitle">Mi c√≥digo de referido</h3>
                            </div>
                            <p class="referral-card-description" data-i18n="referrals.myCodeDescription">
                                Comparte este c√≥digo con amigos y tiendas
                            </p>
                            <div class="referral-code-display" id="myReferralCodeDisplay">
                                <div class="referral-code-loading">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <span data-i18n="referrals.loadingStats">Cargando...</span>
                                </div>
                            </div>
                        </div>

                        <!-- Estad√≠sticas -->
                        <div class="referral-card">
                            <div class="referral-card-header">
                                <i class="fas fa-chart-line"></i>
                                <h3 data-i18n="referrals.statsTitle">Mis estad√≠sticas</h3>
                            </div>
                            <div class="referral-stats-grid" id="referralStatsGrid">
                                <div class="referral-stat">
                                    <div class="referral-stat-icon"><i class="fas fa-users"></i></div>
                                    <div class="referral-stat-info">
                                        <div class="referral-stat-value" id="totalInvites">-</div>
                                        <div class="referral-stat-label" data-i18n="referrals.totalInvites">Total de invitados</div>
                                    </div>
                                </div>
                                <div class="referral-stat">
                                    <div class="referral-stat-icon"><i class="fas fa-credit-card"></i></div>
                                    <div class="referral-stat-info">
                                        <div class="referral-stat-value" id="invitesPaid">-</div>
                                        <div class="referral-stat-label" data-i18n="referrals.invitesPaid">Invitados en pago</div>
                                    </div>
                                </div>
                                <div class="referral-stat">
                                    <div class="referral-stat-icon"><i class="fas fa-clock"></i></div>
                                    <div class="referral-stat-info">
                                        <div class="referral-stat-value" id="invitesTrial">-</div>
                                        <div class="referral-stat-label" data-i18n="referrals.invitesTrial">Invitados en prueba</div>
                                    </div>
                                </div>
                                <div class="referral-stat">
                                    <div class="referral-stat-icon"><i class="fas fa-comments"></i></div>
                                    <div class="referral-stat-info">
                                        <div class="referral-stat-value" id="conversationsEarned">-</div>
                                        <div class="referral-stat-label" data-i18n="referrals.conversationsEarned">Conversaciones ganadas</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de invitados (oculta - ya no se usa) -->
                    <div class="referral-invites-table" id="referralInvitesTable" style="display: none;">
                        <h3 data-i18n="referrals.invitedStores">Tiendas invitadas</h3>
                        <div class="referral-invites-content"></div>
                    </div>
                </div>

                <!-- Email Signature Section -->
                <div class="profile-section" id="emailSignatureSection">
                    <div class="section-header-profile">
                        <h2 data-i18n="profile.emailSignature">Firma de correo</h2>
                        <p data-i18n="profile.emailSignatureDescription">Personaliza la firma que el bot a√±adir√° al final de los mensajes</p>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="emailSignatureEditor" data-i18n="profile.emailSignatureLabel">Tu firma</label>

                            <!-- Contenedor relativo para posicionar el popover -->
                            <div class="rte-container">
                                <!-- Barra de herramientas -->
                                <div class="rte-toolbar" aria-label="Editor toolbar">
                                    <button type="button" class="rte-btn" data-cmd="bold" data-i18n-title="profile.emailSignatureBold" title="Negrita (Ctrl+B)"><i class="fas fa-bold"></i></button>
                                    <button type="button" class="rte-btn" data-cmd="italic" data-i18n-title="profile.emailSignatureItalic" title="Cursiva (Ctrl+I)"><i class="fas fa-italic"></i></button>
                                    <button type="button" class="rte-btn" data-cmd="underline" data-i18n-title="profile.emailSignatureUnderline" title="Subrayado (Ctrl+U)"><i class="fas fa-underline"></i></button>
                                    <button type="button" class="rte-btn" data-cmd="link" data-i18n-title="profile.emailSignatureLink" title="Insertar enlace" id="rteLinkBtn"><i class="fas fa-link"></i></button>
                                    <button type="button" class="rte-btn" data-cmd="removeFormat" data-i18n-title="profile.emailSignatureRemoveFormat" title="Quitar formato"><i class="fas fa-eraser"></i></button>
                                </div>

                                <!-- Editor -->
                                <div id="emailSignatureEditor"
                                    class="rte-editor form-textarea"
                                    role="textbox"
                                    aria-multiline="true"
                                    contenteditable="true"
                                    data-max-bytes="5120">
                                </div>

                                <!-- Popover de enlace -->
                                <div id="rteLinkPopover" class="rte-link-popover hidden" aria-hidden="true">
                                    <div class="rte-link-row">
                                        <input type="url" id="rteLinkInput" class="form-input" data-i18n-placeholder="profile.emailSignatureLinkPlaceholder" placeholder="https://‚Ä¶ o mailto:‚Ä¶">
                                    </div>
                                    <div class="rte-link-actions">
                                        <button type="button" id="rteLinkInsertBtn" class="btn btn-primary" data-i18n="profile.emailSignatureInsert">Insertar</button>
                                        <button type="button" id="rteLinkCancelBtn" class="btn btn-secondary" data-i18n="profile.emailSignatureCancel">Cancelar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="profile-footer">
                    <button id="deleteAccountBtn" class="btn btn-danger">Eliminar cuenta</button>
                </div>
            </div>
            

            <!-- Success/Error Messages -->
            <div class="message-container notify-sticky" id="messageContainer"></div>
        </div>
    </div>
    

    <!-- Hidden file input for avatar upload -->
    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
    <script type="module" src="/js/config.js?v=%ASSET_VERSION%"></script>
    <script type="module" src="/js/components/sidebar.js?v=%ASSET_VERSION%"></script>
    <script type="module" src="/js/pages/perfil.js?v=%ASSET_VERSION%"></script>
</body>
</html>